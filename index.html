<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vega-Lite Visualizations</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>

    <h1>Population Map Visualization</h1>
    <div id="map"></div> <!-- Map visualization -->

    <h1>Select a State for Detailed Population Analysis</h1>
    <select id="stateSelect">
        <option value="All States">All States</option>
        <option value="NSW">New South Wales (NSW)</option>
        <option value="VIC">Victoria (VIC)</option>
        <option value="QLD">Queensland (QLD)</option>
        <option value="SA">South Australia (SA)</option>
        <option value="WA">Western Australia (WA)</option>
        <option value="TAS">Tasmania (TAS)</option>
        <option value="NT">Northern Territory (NT)</option>
    </select>

    <h1>Top 10 LGAs with Highest Percentage Change (Selected State)</h1>
    <div id="diagram_1"></div>

    <h1>Another Visualization (Selected State)</h1>
    <div id="diagram_2"></div>

    <h1>Population Change by Suburbs (Selected State)</h1>
    <div id="diagram_3"></div>

    <h1>ERP 2022 vs. ERP 2023 by Region</h1>
    <div id="act_diagram"></div>

    <script type="text/javascript">
        // Embed the map visualization
        vegaEmbed('#map', 'https://raw.githubusercontent.com/Rusandi17/3179/main/map.vg.json').catch(console.error);

        // Embed the static act_diagram
        vegaEmbed('#act_diagram', 'https://raw.githubusercontent.com/Rusandi17/3179/main/act_diagram.vg.json').catch(console.error);

        // Function to update the dynamic diagrams based on the selected state
        function updateDiagrams(state) {
            if (state === "All States") {
                state = "VIC";  // Default to Victoria when "All States" is selected
            }

            const stateToFileMap = {
                'SA': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_SA.csv',
                'VIC': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_Victoria.csv',
                'NSW': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_NSW.csv',
                'WA': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_WA.csv',
                'TAS': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_Tasmania.csv',
                'NT': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_NT.csv',
                'QLD': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_Queensland.csv'
            };

            // Update diagram_1 (Top 10 LGAs)
            const diagram1Spec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "Top 10 LGAs with Highest Percentage Change in Population (2022 vs. 2023)",
                "data": {
                    "url": stateToFileMap[state],
                    "format": {"type": "csv"}
                },
                "transform": [
                    {"filter": "isValid(datum.ERP_Change_2022_23_percent) && datum.ERP_Change_2022_23_percent != 0"},
                    {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "ERP_Change_2022_23_percent", "order": "descending"}]},
                    {"filter": "datum.rank <= 10"}
                ],
                "mark": "bar",
                "encoding": {
                    "x": {"field": "Local_Government_Area", "type": "nominal", "sort": "-y", "axis": {"title": "LGA Name", "labelAngle": -45}},
                    "y": {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "axis": {"title": "Percentage Change (%)"}},
                    "color": {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "scale": {"scheme": "redyellowgreen"}, "legend": {"title": "Percentage Change"}},
                    "tooltip": [
                        {"field": "Local_Government_Area", "type": "nominal", "title": "LGA Name"},
                        {"field": "ERP_2022", "type": "quantitative", "title": "Population 2022"},
                        {"field": "ERP_2023", "type": "quantitative", "title": "Population 2023"},
                        {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "title": "Percentage Change (%)"}
                    ]
                },
                "config": {"view": {"stroke": "transparent"}, "background": "#f8f8f8"}
            };
            vegaEmbed('#diagram_1', diagram1Spec).catch(console.error);

            // Update diagram_2 (Scatter Plot: Population Density vs. Population Change)
            const diagram2Spec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "Population Density vs. Population Change (2022-2023) in Selected State",
                "data": {
                    "url": stateToFileMap[state],
                    "format": {"type": "csv"}
                },
                "mark": "point",
                "encoding": {
                    "x": {"field": "Population_Density", "type": "quantitative", "axis": {"title": "Population Density"}},
                    "y": {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "axis": {"title": "Percentage Population Change (2022-2023)"}},
                    "tooltip": [
                        {"field": "Local_Government_Area", "type": "nominal", "title": "LGA"},
                        {"field": "Population_Density", "type": "quantitative", "title": "Population Density"},
                        {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "title": "Percentage Population Change (2022-2023)"}
                    ]
                },
                "config": {"view": {"stroke": "transparent"}, "background": "#f8f8f8"}
            };
            vegaEmbed('#diagram_2', diagram2Spec).catch(console.error);

            // Update diagram_3 (Bar Chart: Population Change by Suburbs)
            const diagram3Spec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "Population Change by Suburbs (Natural Increase & Migrations)",
                "data": {
                    "url": stateToFileMap[state],
                    "format": {"type": "csv"}
                },
                "transform": [
                    {
                      "window": [{"op": "row_number", "as": "row_number"}],
                      "sort": [{"field": "Local_Government_Area", "order": "ascending"}]
                    },
                    {
                      "filter": "datum.row_number >= 1 && datum.row_number <= 10"
                    },
                    {
                      "fold": ["Natural_Increase", "Net_Internal_Migration", "Net_Overseas_Migration"],
                      "as": ["Component", "Value"]
                    }
                ],
                "mark": "bar",
                "encoding": {
                    "y": {
                      "field": "Local_Government_Area",
                      "type": "nominal",
                      "axis": {"title": "Local Government Area"}
                    },
                    "x": {
                      "aggregate": "sum",
                      "field": "Value",
                      "type": "quantitative",
                      "axis": {"title": "Population Change"}
                    },
                    "color": {
                      "field": "Component",
                      "type": "nominal",
                      "scale": {
                        "range": ["#6baed6", "#9ecae1", "#c6dbef"]
                      }
                    }
                }
            };
            vegaEmbed('#diagram_3', diagram3Spec).catch(console.error);
        }

        // Attach event listener for state selection change
        document.getElementById('stateSelect').addEventListener('change', function() {
            const selectedState = this.value;
            updateDiagrams(selectedState);
        });

        // Initial render with "All States" selection showing Victoria data by default
        updateDiagrams('All States');
    </script>

</body>
</html>
