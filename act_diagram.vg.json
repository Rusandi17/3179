<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vega-Lite Visualizations</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>

    <h1>Population Map Visualization</h1>
    <div id="map"></div>

    <h1>Select a State for Detailed Population Analysis</h1>
    <select id="stateSelect">
        <option value="All States">All States</option>
        <option value="NSW">New South Wales (NSW)</option>
        <option value="VIC">Victoria (VIC)</option>
        <option value="QLD">Queensland (QLD)</option>
        <option value="SA">South Australia (SA)</option>
        <option value="WA">Western Australia (WA)</option>
        <option value="TAS">Tasmania (TAS)</option>
        <option value="NT">Northern Territory (NT)</option>
    </select>

    <h1>Top 10 LGAs with Highest Percentage Change (Selected State)</h1>
    <div id="diagram_1"></div>

    <h1>ERP 2022 vs. ERP 2023 by Region</h1>
    <div id="act_diagram"></div>

    <script type="text/javascript">
        // Embed the map visualization (if needed)
        vegaEmbed('#map', 'https://raw.githubusercontent.com/Rusandi17/3179/main/map.vg.json').catch(console.error);

        // Function to update the diagrams based on the selected state
        function updateDiagrams(state) {
            if (state === "All States") {
                state = "VIC";  // Default to Victoria when "All States" is selected
            }

            const stateToFileMap = {
                'SA': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_SA.csv',
                'VIC': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_Victoria.csv',
                'NSW': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_NSW.csv',
                'WA': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_WA.csv',
                'TAS': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_Tasmania.csv',
                'NT': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_NT.csv',
                'QLD': 'https://raw.githubusercontent.com/Rusandi17/3179/main/cleaned_LGA_Population_Queensland.csv'
            };

            // Update diagram_1
            const diagram1Spec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "Top 10 LGAs with Highest Percentage Change in Population (2022 vs. 2023)",
                "data": {
                    "url": stateToFileMap[state],
                    "format": {"type": "csv"}
                },
                "transform": [
                    {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "ERP_Change_2022_23_percent", "order": "descending"}]},
                    {"filter": "datum.rank <= 10"}
                ],
                "mark": "bar",
                "encoding": {
                    "x": {"field": "Local_Government_Area", "type": "nominal", "sort": "-y", "axis": {"title": "LGA Name", "labelAngle": -45}},
                    "y": {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "axis": {"title": "Percentage Change (%)"}},
                    "color": {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "scale": {"scheme": "redyellowgreen"}, "legend": {"title": "Percentage Change"}},
                    "tooltip": [
                        {"field": "Local_Government_Area", "type": "nominal", "title": "LGA Name"},
                        {"field": "ERP_2022", "type": "quantitative", "title": "Population 2022"},
                        {"field": "ERP_2023", "type": "quantitative", "title": "Population 2023"},
                        {"field": "ERP_Change_2022_23_percent", "type": "quantitative", "title": "Percentage Change (%)"}
                    ]
                },
                "config": {"view": {"stroke": "transparent"}, "background": "#f8f8f8"}
            };
            vegaEmbed('#diagram_1', diagram1Spec).catch(console.error);

            // Update act_diagram
            const actDiagramSpec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "title": "ERP 2022 vs. ERP 2023 by Region",
                "data": {
                    "url": stateToFileMap[state],
                    "format": {"type": "csv"}
                },
                "transform": [
                    {"fold": ["ERP_2022", "ERP_2023"], "as": ["Year", "Value"]}
                ],
                "mark": "bar",
                "encoding": {
                    "x": {"field": "State_Territory", "type": "nominal", "axis": {"title": "Region"}},
                    "y": {"aggregate": "sum", "field": "Value", "type": "quantitative", "axis": {"title": "Estimated Resident Population"}},
                    "color": {
                        "field": "Year",
                        "type": "nominal",
                        "scale": {"range": ["#0033A0", "#00AEEF"]},
                        "legend": {"title": "Year"}
                    },
                    "tooltip": [
                        {"field": "State_Territory", "type": "nominal", "title": "Region"},
                        {"field": "Value", "type": "quantitative", "title": "Population"},
                        {"field": "Year", "type": "nominal", "title": "Year"}
                    ]
                },
                "config": {"view": {"stroke": "transparent"}, "background": "#f8f8f8"}
            };
            vegaEmbed('#act_diagram', actDiagramSpec).catch(console.error);
        }

        // Attach event listener for state selection change
        document.getElementById('
